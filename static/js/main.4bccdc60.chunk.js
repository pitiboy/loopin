(this.webpackJsonploopin=this.webpackJsonploopin||[]).push([[0],{34:function(e,t,n){e.exports=n(60)},39:function(e,t,n){},57:function(e,t,n){},60:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(9),u=n.n(o),c=(n(39),n(6)),i=n(31),s=n(13),l=n.n(s),p=n(3),d=n(4);function m(){var e=Object(p.a)(["\n  ","\n"]);return m=function(){return e},e}function f(){var e=Object(p.a)(["\n  display: flex;\n"]);return f=function(){return e},e}var b=d.a.div(f()),y=d.a.div(m(),(function(e){return e.active&&"\n    color: green;\n    font-weight: bold;\n  "})),v=function(e){var t=e.playBeat,n=e.step;return a.a.createElement(b,null,t&&t.map((function(e,t){return a.a.createElement(y,{active:t===n,key:t},e)}))||null)};function O(){var e=Object(p.a)(["\n  background-color: lightgray;\n  border: solid 1px gray;\n  border-radius: 4px;\n\n  ","\n"]);return O=function(){return e},e}var g=d.a.button(O(),(function(e){return e.active&&"\n    background-color: green;\n  "}));function h(){var e=Object(p.a)(["\n  display: flex;\n"]);return h=function(){return e},e}var j=d.a.div(h()),w=function(e){var t=e.muted,n=e.setMuted;return a.a.createElement(j,null,a.a.createElement(g,{onClick:function(){return n(!t)},active:t},"Mute"))};function k(){var e=Object(p.a)(["\n  flex: 0 0 auto;\n  width: 100px;\n  text-overflow: ellipsis;\n  overflow: hidden;\n"]);return k=function(){return e},e}function E(){var e=Object(p.a)(["\n  display: flex;\n\n  * {\n    flex: 1 1 auto;\n  }\n\n  "," {\n    flex: 0 0 auto;\n  }\n"]);return E=function(){return e},e}var x,I,D=d.a.div(E(),j),P=d.a.b(k()),N=D;!function(e){e.all="all",e.odd="odd",e.even="even",e.oddQuarter="quarter",e.evenQuarter="evenQuarter",e.first="first",e.last="last"}(x||(x={})),function(e){e[e.drum=110]="drum",e[e.bass=120]="bass",e[e.string=130]="string",e[e.key=190]="key",e[e.recording=101]="recording",e[e.other=900]="other"}(I||(I={}));var C,R,T,_,B,S,A=n(29),L=n(10),M=n(7),z=n(8),Q=n(5),W=(n(56),n(2));function U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var q,J=[],F=function(e){return J.slice().concat.apply([],e)},H=(C=function(){function e(){Object(M.a)(this,e),Object(L.a)(this,"tracks",R,this),Object(L.a)(this,"add",T,this),Object(L.a)(this,"remove",_,this),Object(L.a)(this,"update",B,this),Object(L.a)(this,"mute",S,this)}return Object(z.a)(e,[{key:"_update",value:function(e){console.log("_update",e),this.tracks=this.tracks.slice().map((function(t){return t.name===e.name?function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?U(Object(n),!0).forEach((function(t){Object(A.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{},e):t})),console.log("this.tracks",this.tracks)}},{key:"_remove",value:function(e){console.log("remove ",e)}},{key:"_add",value:function(e){console.log("add new ",e)}},{key:"drums",get:function(){return this.tracks.filter((function(e){return e.type===I.drum}))}},{key:"drumInstrumentIds",get:function(){return F(this.drums.map((function(e){return e.instrument})))}},{key:"bassers",get:function(){return this.tracks.filter((function(e){return e.type===I.bass}))}},{key:"bassersInstrumentIds",get:function(){return F(this.bassers.map((function(e){return e.instrument})))}},{key:"recordings",get:function(){return this.tracks.filter((function(e){return e.type===I.recording}))}}]),e}(),R=Object(Q.a)(C.prototype,"tracks",[W.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[{name:"kickdrum",type:I.drum,instrument:1,divider:2,playType:x.oddQuarter,muted:!0},{name:"kickdrum variety",type:I.drum,instrument:1,divider:2,playBeat:[0,1,0,0,0,1,0,0,0,0,0,1,0,0,0,1],muted:!0},{name:"snaredrum",type:I.drum,instrument:16,divider:1,playType:x.even,muted:!0},{name:"cin",type:I.drum,instrument:39,divider:4,playType:x.even,muted:!0},{name:"korgbass 2",type:I.bass,instrument:371,pitches:[30],duration:1,divider:4,playType:x.odd,muted:!0},{name:"quitar1",type:I.bass,instrument:307,duration:1,divider:2,playBeat:[50,0,53,54,55,0,50,0,50,0,53,54,55,0,50,0,50,0,53,54,55,0,50,0,51,0,54,55,56,0,52,0],muted:!0}]}}),Object(Q.a)(C.prototype,"drums",[W.e],Object.getOwnPropertyDescriptor(C.prototype,"drums"),C.prototype),Object(Q.a)(C.prototype,"drumInstrumentIds",[W.e],Object.getOwnPropertyDescriptor(C.prototype,"drumInstrumentIds"),C.prototype),Object(Q.a)(C.prototype,"bassers",[W.e],Object.getOwnPropertyDescriptor(C.prototype,"bassers"),C.prototype),Object(Q.a)(C.prototype,"bassersInstrumentIds",[W.e],Object.getOwnPropertyDescriptor(C.prototype,"bassersInstrumentIds"),C.prototype),Object(Q.a)(C.prototype,"recordings",[W.e],Object.getOwnPropertyDescriptor(C.prototype,"recordings"),C.prototype),Object(Q.a)(C.prototype,"_update",[W.d],Object.getOwnPropertyDescriptor(C.prototype,"_update"),C.prototype),Object(Q.a)(C.prototype,"_remove",[W.d],Object.getOwnPropertyDescriptor(C.prototype,"_remove"),C.prototype),Object(Q.a)(C.prototype,"_add",[W.d],Object.getOwnPropertyDescriptor(C.prototype,"_add"),C.prototype),T=Object(Q.a)(C.prototype,"add",[W.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this._add.bind(this)}}),_=Object(Q.a)(C.prototype,"remove",[W.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this._remove.bind(this)}}),B=Object(Q.a)(C.prototype,"update",[W.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this._update.bind(this)}}),S=Object(Q.a)(C.prototype,"mute",[W.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this._update.bind(this)}}),C),K=(q=function(){function e(){Object(M.a)(this,e)}return Object(z.a)(e,[{key:"step",get:function(){return 0}}]),e}(),Object(Q.a)(q.prototype,"step",[W.e],Object.getOwnPropertyDescriptor(q.prototype,"step"),q.prototype),q),V={trx:new H,mtn:new K},$=Object(r.createContext)(V),G=function(e){var t=e.bpm,n=e.metronomeBpm,o=e.looping,u=void 0===o||o,i=e.rythmLength,s=e.playType,l=void 0===s?x.odd:s,p=e.playBeat,d=e.source,m=e.step,f=e.render,b=e.name,y=e.duration,O=e.muted,g=t&&n&&t/n||1,h=(m||0)*g,j=Object(r.useContext)($).trx,k=f||v,E=Object(r.useState)(p&&p.slice()||function(e){var t=e.playType,n=(e.rythmLength||0)*e.multiplier;switch(t){case x.odd:return new Array(n).fill(0).map((function(e,t){return 1-t%2}));case x.even:return new Array(n).fill(0).map((function(e,t){return t%2}));case x.oddQuarter:return new Array(n).fill(0).map((function(e,t){return t%4?0:1}));case x.evenQuarter:return new Array(n).fill(0).map((function(e,t){return t%4===2?1:0}));case x.first:return new Array(n).fill(0).map((function(e,t){return 0===t?1:0}));case x.last:return new Array(n).fill(0).map((function(e,t){return t===n-1?1:0}));case x.all:default:return new Array(n).fill(1)}}({playType:l,rythmLength:i,multiplier:g})),I=Object(c.a)(E,2),D=I[0],C=I[1];return Object(r.useEffect)((function(){u&&D[h]&&d&&!O&&d({pitches:[D[h]],duration:y})}),[m,u]),a.a.createElement(N,null,a.a.createElement(P,null,b),a.a.createElement(w,{muted:!!O,setMuted:function(){return j.mute({name:b,muted:!O})}}),a.a.createElement(k,{playBeat:D,step:h,setPlayBeat:function(e){return C(e)}}))},X=(n(57),function(e){var t=e.bpm,n=void 0===t?60:t,o=e.looping,u=void 0===o||o,i=e.rythmLength,s=void 0===i?8:i,l=e.rythmDivider,p=void 0===l?16:l,d=e.children,m=Object(r.useState)(new Date),f=Object(c.a)(m,2),b=f[0],y=f[1],v=Object(r.useState)(0),O=Object(c.a)(v,2),g=O[0],h=O[1],j=Object(r.useState)(),w=Object(c.a)(j,2),k=w[0],E=w[1],x=60/n*1e3;Object(r.useEffect)((function(){u&&(y(new Date),k&&clearTimeout(k),E(setInterval((function(){return function(){var e=((new Date).getTime()-b.getTime())/x,t=Math.floor(e)%s,n=Math.floor((e-Math.floor(e))*s)/8;h(t+n)}()}),x/p)))}),[x,u]);var I=a.a.Children.map(d,(function(e){return a.a.cloneElement(e,{metronomeBpm:n,step:g,rythmLength:s})}));return a.a.createElement(a.a.Fragment,null,a.a.createElement("h1",null,g),I)});function Y(){var e=Object(p.a)(["\n  border-radius: 4px;\n  border: solid 1px black;\n  background: gray;\n  margin: 3px;\n  flex: 1 1 auto;\n  height: 50px;\n  overflow: hidden;\n  color: #515e2d;\n\n  ","\n\n  ","\n  ","\n"]);return Y=function(){return e},e}function Z(){var e=Object(p.a)(["\n  display: flex;\n"]);return Z=function(){return e},e}var ee=d.a.div(Z()),te=d.a.button(Y(),(function(e){return!e.enabled&&e.active&&"\n    background: #999;\n  "}),(function(e){return e.enabled&&"\n    background: #515e2d;\n  "}),(function(e){return e.enabled&&e.active&&"\n    background: rgb(180,193,38);\n    background: radial-gradient(circle, rgba(180,193,38,1) 35%, rgba(112,125,76,1) 100%);\n  "})),ne=function(e){var t=e.playBeat,n=e.step,r=e.setPlayBeat;return a.a.createElement(ee,null,t&&t.map((function(e,o){return a.a.createElement(te,{active:o===n,enabled:e>0,key:o,onClick:function(){return function(e){if(r){var n=t.slice();n[e]=n[e]?0:1,r(n)}}(o)}},e)}))||null)};function re(){var e=Object(p.a)(["\n  display: flex;\n  font-size: 2rem;\n  font-weight: bold;\n  align-items: center;\n  justify-content: flex-start;\n\n  ","\n\n  .MIDISounds {\n    margin: 0px 10px;\n    &>* {\n      display: flex;\n      align-items: center;\n\n      &:after {\n        content: 'config';\n        font-size: initial;\n      }\n    }\n    svg {\n      width: 40px;\n      height: 30px;\n    }\n  }\n"]);return re=function(){return e},e}var ae=d.a.section(re(),(function(e){return e.title&&"\n    &:before {\n      content: '".concat(e.title,":';\n      text-decoration: underline;\n    }\n  ")})),oe=n(11),ue=(n(58),function(e){var t=e.playNote,n=oe.b.fromNote("c3"),r=oe.b.fromNote("f5"),o=oe.a.create({firstNote:n,lastNote:r,keyboardConfig:oe.a.HOME_ROW});return a.a.createElement(oe.c,{noteRange:{first:n,last:r},playNote:t,stopNote:function(e){},width:document.body.clientWidth,keyboardShortcuts:o})});function ce(){var e=Object(p.a)([""]);return ce=function(){return e},e}var ie=d.a.div(ce()),se=function(){return a.a.createElement(ie,null,"TODO:SLIDER")},le=n(12),pe=n.n(le),de=n(21),me=new(n(30).a)({wasmURL:"https://unpkg.com/vmsg@0.3.0/vmsg.wasm"}),fe=function(){var e=Object(r.useState)(!1),t=Object(c.a)(e,2),n=t[0],o=t[1],u=Object(r.useState)(""),i=Object(c.a)(u,2),s=i[0],l=i[1],p=Object(r.useRef)(null),d=Object(r.useRef)(null),m=new Audio,f=function(){var e=Object(de.a)(pe.a.mark((function e(){return pe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o(!0),e.next=3,me.initAudio();case 3:return e.next=5,me.initWorker();case 5:me.startRecording();case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),b=function(){var e=Object(de.a)(pe.a.mark((function e(){var t,n;return pe.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o(!1),e.next=3,me.stopRecording();case 3:return t=e.sent,n=window.URL.createObjectURL(t),console.log("bloburl",t.size,n),e.next=8,l("");case 8:setTimeout((function(){l(n)}),1e3),setTimeout((function(){p.current.load()}),2e3),setTimeout((function(){console.log("audioRef",p.current),p&&p.current&&(console.log("blob",t),console.log("audio element",p.current),console.log("audio element",p.current.currentSrc),p.current.load())}),6e3),setTimeout((function(){console.log("play audio",m),m&&d.current&&(m.src=n,m.controls=!0,m.load(),d.current.appendChild(m),m.play())}),1e4);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return a.a.createElement(N,{ref:d},!n&&a.a.createElement(g,{onClick:function(){return f()}},"Record"),n&&a.a.createElement(g,{onClick:function(){return b()}},"stop"),s&&!n&&a.a.createElement("audio",{ref:p,controls:!0},a.a.createElement("source",{src:s,type:"audio/mpeg"})),a.a.createElement("small",{style:{flex:"0 0 0"}},"url: ",s))},be=Object(i.a)((function(){var e=Object(r.useRef)(null),t=Object(r.useRef)(null),n=Object(r.useRef)(null),o=Object(r.useState)(847),u=Object(c.a)(o,2),i=u[0],s=u[1],p=Object(r.useState)(80),d=Object(c.a)(p,2),m=d[0],f=d[1],b=Object(r.useContext)($).trx,y=function(e){if(null!==n&&null!==n.current){var t=[].concat(e);n.current.playChordNow(i,t,.5)}};return a.a.createElement("div",{className:"App"},"set BPM: ",a.a.createElement("input",{type:"number",value:m,onChange:function(e){return f(parseInt(e.target.value,10))},min:30,max:300}),a.a.createElement(se,null),a.a.createElement(X,{bpm:m},a.a.createElement(ae,{title:"Drums"},a.a.createElement(l.a,{ref:e,appElementName:"root",drums:b.drumInstrumentIds})),b.drums.map((function(t){return a.a.createElement(G,Object.assign({},t,{key:t.name,bpm:m*t.divider,source:function(){return e.current&&e.current.playDrumsNow([t.instrument])},render:ne}))})),a.a.createElement(ae,{title:"Bass"},a.a.createElement(l.a,{ref:t,appElementName:"root",instruments:b.bassersInstrumentIds})),b.bassers.map((function(t){return a.a.createElement(G,Object.assign({},t,{key:t.name,bpm:m*t.divider,source:function(n){var r=n.pitches,a=n.duration;return e.current&&e.current.playChordNow(t.instrument,t.pitches||r||[30],a||1)},render:ne}))})),a.a.createElement(ae,{title:"Voice"},b.recordings.map((function(t){return a.a.createElement(G,Object.assign({},t,{key:t.name,bpm:m*t.divider,source:function(n){var r=n.pitches,a=n.duration;return e.current&&e.current.playChordNow(t.instrument,t.pitches||r||[30],a||1)},render:ne}))})),a.a.createElement(fe,null))),a.a.createElement(ae,{title:"Keys"},a.a.createElement(l.a,{ref:n,appElementName:"root",instruments:[1,2,3,305,847]}),a.a.createElement("input",{type:"number",value:i,onChange:function(e){return t=parseInt(e.target.value,10),console.log("trying to cache instrument",t),n.current&&(n.current.cacheInstrument(t),n.current.player.loader.waitLoad((function(){return y(50)}))),void s(t);var t},min:0,max:1393})),a.a.createElement(ue,{playNote:function(e){return y(e)}}))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));u.a.render(a.a.createElement(be,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[34,1,2]]]);
//# sourceMappingURL=main.4bccdc60.chunk.js.map